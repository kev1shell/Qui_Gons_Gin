<!DOCTYPE html>
<html>
<style src="css/UIclasses.css"></style>
<head>
	<title>VillageWars</title>
	<script src="http://code.createjs.com/easeljs-0.7.1.min.js"></script>
	<script src = "javascript/objects.js">
		//objects (their like classes) (I think)
	</script>
	<script>
		/*-------------------global variables----------------------*/
		var player = Player;
		
		var infoText = "hello";
		
		var turnNum = 0;
		
		var canvas, stage;
		var mapElement, bitmap;
		var resourceElement, bitmap2;
		
		/*---------------------------------------------------------*/
		/*-------------------update functions----------------------*/
		function updateTurnNum()
		{	
			
			if(stage.getChildByName("TCtext") == null)
			{
				var TCtext = new createjs.Text(turnNum, "bold 14px Arial", "black");
				TCtext.x = 704;
				TCtext.y = 20;
				TCtext.name = "TCtext";
				stage.addChild(TCtext);
			}
			else
			{
				stage.getChildByName("TCtext").text = turnNum;
			}
			
			stage.update();
			
		}
		
		function updateInfoText()
		{
			//info text
			if(stage.getChildByName("IEtext") == null)
			{
				var IEtext = new createjs.Text(infoText, "bold 14px Arial", "black");
				IEtext.x = 340;
				IEtext.y = 13;
				IEtext.name = "IEtext";
				stage.addChild(IEtext);
			}
			else
			{
				stage.getChildByName("IEtext").text = infoText;
			}
			
			stage.update();
		}
		
		function updateResources()
		{
			//food text
			if(stage.getChildByName("REfoodNum") == null)
			{
				var REfoodNum = new createjs.Text(player.bank.food, "bold 14px Arial", "black");
				REfoodNum.x = 31;
				REfoodNum.y = 3;
				REfoodNum.name = "REfoodNum";
				stage.addChild(REfoodNum);
				
				var foodRateColor = "black";
				var extraPlus = "";
				if(player.bank.foodRate > 0)
				{
					foodRateColor = "green";
					extraPlus = "+";
				}
				else if(player.bank.foodRate < 0)
				{
					foodRateColor = "red";
				}
				
				var REfoodRate = new createjs.Text("(" + extraPlus + player.bank.foodRate + ")", "bold 14px Arial", foodRateColor);
				REfoodRate.x = REfoodNum.x + REfoodNum.getMeasuredWidth() + 2; 
				REfoodRate.y = REfoodNum.y;
				REfoodRate.name = "REfoodRate";
				stage.addChild(REfoodRate);
			}
			else
			{
				stage.getChildByName("REfoodNum").text = player.bank.food;
				
				var extraPlus = "";
				if(player.bank.foodRate > 0)
				{
					stage.getChildByName("REfoodRate").color = "green";
					extraPlus = "+";
				}
				else if(player.bank.foodRate < 0)
				{
					stage.getChildByName("REfoodRate").color = "red";
				}
				stage.getChildByName("REfoodRate").text = "(" + extraPlus + player.bank.foodRate + ")";
				stage.getChildByName("REfoodRate").x = stage.getChildByName("REfoodNum").x + stage.getChildByName("REfoodNum").getMeasuredWidth() + 2;
			}
			
			//timber text
			if(stage.getChildByName("REtimberNum") == null)
			{
				var REtimberNum = new createjs.Text(player.bank.timber + " (+" + player.bank.timberRate + ")", "bold 14px Arial", "black");
				REtimberNum.x = 130;
				REtimberNum.y = 3;
				REtimberNum.name = "REtimberNum";
				stage.addChild(REtimberNum);
			}
			else
			{
				stage.getChildByName("REtimberNum").text = player.bank.timber + " (+" + player.bank.timberRate + ")";
			}
			
			//stone text
			if(stage.getChildByName("REstoneNum") == null)
			{
				var REstoneNum = new createjs.Text(player.bank.stone + " (+" + player.bank.stoneRate + ")", "bold 14px Arial", "black");
				REstoneNum.x = 235;
				REstoneNum.y = 3;
				REstoneNum.name = "REstoneNum";
				stage.addChild(REstoneNum);
			}
			else
			{
				stage.getChildByName("REstoneNum").text = player.bank.stone + " (+" + player.bank.stoneRate + ")";
			}
			
			//farm counter text
			if(stage.getChildByName("REfarmNum") == null)
			{
				var REfarmNum = new createjs.Text(player.numFarms, "bold 14px Arial", "black");
				REfarmNum.x = 31;
				REfarmNum.y = 24;
				REfarmNum.name = "REfarmNum";
				stage.addChild(REfarmNum);
			}
			else
			{
				stage.getChildByName("REfarmNum").text = player.numFarms;
			}
			
			//villager counter text
			if(stage.getChildByName("REvillagerNum") == null)
			{
				var REvillagerNum = new createjs.Text(player.numVillagers, "bold 14px Arial", "black");
				REvillagerNum.x = 130;
				REvillagerNum.y = 24;
				REvillagerNum.name = "REvillagerNum";
				stage.addChild(REvillagerNum);
			}
			else
			{
				stage.getChildByName("REvillagerNum").text = player.numVillagers;
			}
			
			//warrior text
			if(stage.getChildByName("REwarriorNum") == null)
			{
				var REwarriorNum = new createjs.Text(player.numWarriors, "bold 14px Arial", "black");
				REwarriorNum.x = 235;
				REwarriorNum.y = 24;
				REwarriorNum.name = "REwarriorNum";
				stage.addChild(REwarriorNum);
			}
			else
			{
				stage.getChildByName("REwarriorNum").text = player.numWarriors;
			}
			
			stage.update();
		}
		
		
		/*----------------------------------------------------------*/
		/*-------------------display functions----------------------*/
		function displayResourceElement()
		{
			//resource element 
			resourceElement = new Image();
			resourceElement.onload = handleRELoad;
			resourceElement.src = "http://students.cse.tamu.edu/tjb33/assets/sprites/ui/ResourceElement.png";
		}
		
		function displayInfoElement()
		{
			//info element
			var IEsquare = new createjs.Shape();
			IEsquare.graphics.beginStroke("Black").drawRect(0, 0, 350, 43);
			IEsquare.x = 325;
			IEsquare.y = 0;
			stage.addChild(IEsquare);
			updateInfoText();
		}
		
		function displayMapElement()
		{
			//map element
			mapElement = new Image();
			mapElement.onload = handleMapLoad;
			mapElement.src = "http://students.cse.tamu.edu/tjb33/assets/maps/survivorIsland3.png";
		}
		
		function displayEndTurnElement(color)
		{
			//end turn element
			if(stage.getChildByName("ETsquare") == null)
			{
				stage.removeChild(stage.getChildByName("ETsquare"));
			}
			
			var ETsquare = new createjs.Shape();
			ETsquare.graphics.beginFill(color).drawRect(0, 0, 100, 43);
			ETsquare.x = 740;
			ETsquare.y = 0;
			ETsquare.name = "ETsquare";
			
			ETsquare.on("click", handleETEMouseEvent);
			ETsquare.on("mouseover", handleETEMouseEvent);
			ETsquare.on("mouseout", handleETEMouseEvent);
			
			stage.addChild(ETsquare);
			
			//end turn text
			var ETtext = new createjs.Text("End Turn", "bold 20px Arial", "black");
			ETtext.x = 745;
			ETtext.y = 10;
			stage.addChild(ETtext);
		}
		
		function displayTurnCounterElement()
		{
			//turn counter
			var TCsquare = new createjs.Shape();
			TCsquare.graphics.beginFill("lightGreen").drawRect(0, 0, 40, 43);
			TCsquare.x = stage.getChildByName("ETsquare").x - 40;
			TCsquare.y = 0;
			stage.addChild(TCsquare);
			
			//turn counter tital
			var TCtital = new createjs.Text("Turn", "bold 14px Arial", "black");
			TCtital.x = 704;
			TCtital.y = 5;
			stage.addChild(TCtital);
			
			updateTurnNum();
		}
		
		/*----------------------------------------------------------*/
		/*-------------------init function--------------------------*/
		function init()
		{
			
			//graphics stage set-up
			stage = new createjs.Stage("demoCanvas");
			stage.autoClear = true;
			stage.enableMouseOver();
			 
			displayResourceElement();
			
			displayInfoElement();
			
			displayMapElement();
			
			displayEndTurnElement("salmon");
			
			displayTurnCounterElement();
			
			stage.update();
		}
		
		/*--------------------------------------------------------------*/
		/*-------------------mouse event functions----------------------*/
		function handleETEMouseEvent(evt)
		{
			if(evt.type == "click")
			{
				infoText = "Turn Ended"
				updateInfoText();
			}
			if(evt.type == "mouseover")
			{
				displayEndTurnElement("red");
				stage.update();
			}
			if(evt.type == "mouseout")
			{
				displayEndTurnElement("salmon");
				stage.update();
			}
		}
		
		function handleMapMouseEvent(evt) 
		{
			//output.text = "evt.target: "+evt.target+", evt.type: "+evt.type;
			
			if(evt.type == "click")
			{
				var x = evt.stageX - evt.target.x;
				var y = evt.stageY - evt.target.y;
				var row = Math.floor(y/24);
				var column = Math.floor(x/24);
				infoText = "Tile:(" + row + "," + column + ")";
				
				updateInfoText();
			}
			//stage.update();
		}
		
		/*-------------------------------------------------------------*/
		/*-------------------image load functions----------------------*/
		
		function handleRELoad()
		{
			bitmap2 = new createjs.Bitmap(resourceElement);
			bitmap2.x = 0;
			bitmap2.y = 0;
			stage.addChild(bitmap2);
			updateResources();
			stage.update();
		}
		
		function handleMapLoad()
		{
			bitmap = new createjs.Bitmap(mapElement);
			bitmap.x = 0;
			bitmap.y = 50;
			
			var mapBackgroud = new createjs.Shape();
			mapBackgroud.graphics.beginFill("white").drawRect(0, 0, 840, 432);
			mapBackgroud.x = bitmap.x;
			mapBackgroud.y = bitmap.y;
			mapBackgroud.on("click", handleMapMouseEvent);
			
			stage.addChild(mapBackgroud);
			stage.addChild(bitmap);
			
			stage.update();
		}
		
		/*----------------------------------------------------------*/
	</script>
	
	<p id="testOutput"></p>
	<script>
		function onTileClick()
		{
			document.getElementById("testOutput").innerHTML = "TIMMAH!";
		}
	</script>
</head>
<body onLoad="init();">
	<canvas id="demoCanvas" width="1200" height="700">
		alternate content
	</canvas>
</body>
</html>